---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Head from "../components/Head.astro";
---

<!doctype html>
<html lang="es">
  <head>
    <Head />
  </head>
  <body class="font-sans bg-cream text-ink">
    <!-- Barra superior de anuncio -->
    <div class="topbar" id="topbar">
      <div class="container">
        <span
          >Novedad: Envíos nacionales gratis desde $120.000 · Nuevas cosechas
          Huila & Nariño</span
        >
        <button class="topbar-close" aria-label="Cerrar" id="topbarClose"
          >×</button
        >
      </div>
    </div>

    <!-- Capa de transicion de pagina -->
    <div class="transition-overlay" id="transitionOverlay" aria-hidden="true">
    </div>

    <Header />

    <main class="container">
      <slot />
    </main>

    <Footer />

    <!-- Scripts globales -->
    <script is:inline src="/assets/js/cart.js"></script>
    <script is:inline src="/assets/js/auth-refresh.js"></script>
    <script>
      // Utilidades globales (Metrics, Theme, Topbar)
      (function () {
        const $ = (s, r = document) => r.querySelector(s);

        // Cierre de barra superior
        const topbar = $("#topbar");
        const topbarClose = $("#topbarClose");

        const setHeaderMetrics = () => {
          const tb = $("#topbar");
          const top = tb ? tb.offsetHeight : 0;
          const headerCont = document.querySelector(".site-header .container");
          // @ts-ignore
          const hh = headerCont ? headerCont.offsetHeight : 96;
          const pageOffset = top + hh + 12;
          const root = document.documentElement;
          root.style.setProperty("--header-top", top + "px");
          root.style.setProperty("--header-height", hh + "px");
          root.style.setProperty("--page-offset-top", pageOffset + "px");
        };
        setHeaderMetrics();
        window.addEventListener("resize", setHeaderMetrics);
        if (topbar && topbarClose) {
          topbarClose.addEventListener("click", () => {
            topbar.style.height = topbar.offsetHeight + "px";
            requestAnimationFrame(() => {
              topbar.style.transition = "height .25s ease, opacity .25s ease";
              topbar.style.height = "0px";
              topbar.style.opacity = "0";
              setTimeout(() => {
                topbar.remove();
                setHeaderMetrics();
              }, 300);
            });
          });
        }
      })();
    </script>
  </body>
</html>
